<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auto Test - App de Clima</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Courier New", monospace;
        background: #1e1e1e;
        color: #d4d4d4;
        padding: 20px;
        min-height: 100vh;
      }

      .console {
        background: #252526;
        border: 1px solid #3e3e42;
        padding: 15px;
        border-radius: 5px;
        font-size: 12px;
        line-height: 1.6;
        max-height: 800px;
        overflow-y: auto;
      }

      .line {
        margin: 2px 0;
        padding: 2px 5px;
      }

      .pass {
        color: #4ec9b0;
      }

      .fail {
        color: #f48771;
      }

      .info {
        color: #9cdcfe;
      }

      .debug {
        color: #858585;
        font-size: 10px;
      }

      .error {
        color: #f48771;
        background: #3d2626;
        padding: 5px;
        border-left: 3px solid #f48771;
      }
    </style>
  </head>
  <body>
    <div class="console" id="console"></div>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/api.test.js"></script>

    <script>
      // Capturar console.log
      const originalLog = console.log;
      const originalError = console.error;

      function addLine(message, type = "info") {
        const consoleDiv = document.getElementById("console");
        const line = document.createElement("div");
        line.className = `line ${type}`;
        line.textContent = message;
        consoleDiv.appendChild(line);
        consoleDiv.scrollTop = consoleDiv.scrollHeight;
      }

      console.log = function (...args) {
        const message = args
          .map((arg) =>
            typeof arg === "object"
              ? JSON.stringify(arg, null, 2)
              : String(arg),
          )
          .join(" ");
        addLine(message, "info");
        originalLog(...args);
      };

      console.error = function (...args) {
        const message = args
          .map((arg) =>
            typeof arg === "object" ? JSON.stringify(arg) : String(arg),
          )
          .join(" ");
        addLine(message, "error");
        originalError(...args);
      };

      // Rodar testes automaticamente
      async function autoRunTests() {
        addLine("=".repeat(60), "info");
        addLine("ðŸ§ª AUTO-EXECUTANDO TESTES", "info");
        addLine("=".repeat(60), "info");

        const result = await tester.run();

        addLine("=".repeat(60), "info");
        addLine(
          `RESUMO: ${result.passed} passaram, ${result.failed} falharam`,
          "info",
        );
        addLine("=".repeat(60), "info");
      }

      // Quando a pÃ¡gina carregar, rodar testes
      window.addEventListener("load", () => {
        autoRunTests();
      });
    </script>
  </body>
</html>
